# 5. XSS、CSRF、SQL 注入、点击劫持攻击与防御以及四者间关系

## XSS

### **一、什么是 XSS**

XSS（Cross-Site Scripting）`跨站脚本攻击`，是一种`代码注入攻击`。攻击者通过在目标网站上`注入恶意脚本`，当用户访问该网站时，恶意脚本会`在用户的浏览器中执行`，从而`窃取用户的敏感信息、篡改页面内容或执行其他恶意操作`。

### **二、XSS 攻击的类型**

1. **反射型 XSS**：攻击者将恶意脚本作为 URL 的一部分发送给用户，当`用户点击该 URL 时，恶意脚本会在用户的浏览器中执行`。
2. **存储型 XSS**：攻击者`将恶意脚本存储在目标网站的数据库中`，当用户访问该网站时，恶意脚本会从数据库中取出并在用户的浏览器中执行。
3. **DOM 型 XSS**：攻击者通过`修改页面的 DOM 结构来注入恶意脚本`，当用户访问该页面时，恶意脚本会在用户的浏览器中执行。

### **三、XSS 攻击的危害**

1. **窃取用户信息**：攻击者可以通过 XSS 攻击窃取用户的登录凭证、信用卡信息等敏感信息。
2. **篡改页面内容**：攻击者可以通过 XSS 攻击篡改页面内容，例如在页面上显示虚假的信息或链接。
3. **执行恶意操作**：攻击者可以通过 XSS 攻击在用户的浏览器中执行恶意操作，例如下载恶意软件、发送垃圾邮件等。

### **四、XSS 攻击的防御**

1. **输入验证**：对用户输入的数据进行严格的验证，确保输入的数据符合预期的格式和内容。
2. **输出编码**：对输出到页面的数据进行编码，例如将 HTML 特殊字符转换为实体编码，以防止恶意脚本的执行。
3. **使用 CSP**：Content Security Policy（内容安全策略）是一种用于防止 XSS 攻击的安全机制，通过设置 CSP 规则，可以限制页面中可以加载的资源和脚本的来源。
4. **设置 HttpOnly**：将 Cookie 设置为 HttpOnly，可以防止 JavaScript 脚本访问 Cookie，从而减少 XSS 攻击的危害。
5. **定期安全审计**：定期对网站进行安全审计，及时发现和修复安全漏洞，以防止 XSS 攻击的发生。

## CSRF

### **一、什么是 CSRF**

`CSRF`（Cross-Site Request Forgery）`跨站请求伪造`，是一种`利用用户已登录的身份，在用户不知情的情况下，以用户的名义发送恶意请求的攻击方式`。攻击者通过`诱使用户点击恶意链接或提交恶意表单`，从而执行一些对用户有害的操作，例如修改用户密码、转账等。

### **二、CSRF 攻击的原理**

CSRF 攻击的原理是`利用浏览器的同源策略`。

同源策略是浏览器的一种安全机制，它限制了不同源的文档之间的交互。例如，一个网站的脚本不能访问另一个网站的文档。

但是，当用户`登录了一个网站后，浏览器会保存该网站的 Cookie`。

如果攻击者能够`诱使用户访问另一个网站，并且该网站发送了一个请求到用户登录的网站`，那么浏览器会自动携带用户的 Cookie 信息，从而使得请求看起来像是用户自己发送的。

### **三、CSRF 攻击的危害**

1. **窃取用户信息**：攻击者可以通过 CSRF 攻击窃取用户的登录凭证、信用卡信息等敏感信息。
2. **篡改用户数据**：攻击者可以通过 CSRF 攻击篡改用户的数据，例如修改用户的密码、删除用户的文件等。
3. **执行恶意操作**：攻击者可以通过 CSRF 攻击在用户的浏览器中执行恶意操作，例如下载恶意软件、发送垃圾邮件等。

### **四、CSRF 攻击的防御**

1. **验证TOken**：用户成功登录时，服务器生成一个唯一的 Token，在后续的接口请求中，将 Token 作为参数或请求头的一部分随请求一起发送给服务器验证token;Token 需要定期更新；
2. **使用 CSRF 令牌**：在表单中`添加一个随机的 CSRF 令牌`，并在服务器端验证该令牌。只有当令牌匹配时，服务器才会处理请求。
3. **限制请求方法**：限制请求方法为 `POST`，因为 `GET 请求可以被浏览器缓存`，从而增加了 CSRF 攻击的风险。
4. **检查 referer 头**：`检查请求的 referer 头`，确保请求来自于合法的网站。但是，`referer 头可以被伪造`，因此不能完全依赖它来防御 CSRF 攻击。
5. **设置 SameSite Cookie**：将 Cookie 的 `SameSite` 属性设置为 `Strict` 或 `lax`，可以`防止浏览器在跨站请求中自动携带 Cookie`。
6. **定期安全审计**：定期对网站进行安全审计，及时发现和修复安全漏洞，以防止 CSRF 攻击的发生。

## SQL 注入攻击与防御

### **一、什么是 SQL 注入**

SQL 注入（SQL Injection）是一种常见的 Web 安全漏洞，它发生在应用程序与数据库进行交互时。

攻击者通过`在输入参数中插入恶意的 SQL 代码，从而改变 SQL 语句的执行逻辑`，达到窃取数据、篡改数据或执行其他恶意操作的目的。

### **二、SQL 注入的危害**

1. **窃取敏感信息**：攻击者可以通过 SQL 注入获取数据库中的用户密码、信用卡信息等敏感信息。
2. **篡改数据**：攻击者可以通过 SQL 注入修改数据库中的数据，例如修改用户的密码、删除用户的记录等。
3. **执行恶意操作**：攻击者可以通过 SQL 注入执行一些恶意操作，例如删除数据库中的所有数据、执行系统命令等。
4. **绕过认证**：攻击者可以通过 SQL 注入绕过应用程序的认证机制，从而获取未授权的访问权限。

### **三、SQL 注入的攻击方式**

1. **直接注入**：攻击者直接在输入参数中插入恶意的 SQL 代码。
2. **间接注入**：攻击者通过在输入参数中插入一些特殊字符，从而改变 SQL 语句的执行逻辑。
3. **二阶注入**：攻击者通过在输入参数中插入一些恶意的 SQL 代码，这些代码会在数据库中存储一段时间，然后在后续的查询中被执行。

### **四、SQL 注入的防御**

1. **使用参数化查询**：使用参数化查询可以将用户输入的参数与 SQL 语句分开，从而避免 SQL 注入攻击。
2. **输入验证**：对用户输入的参数进行严格的验证，确保输入的参数符合预期的格式和内容。
3. **最小权限原则**：为数据库用户分配最小的权限，避免用户拥有过高的权限。
4. **使用存储过程**：使用存储过程可以将 SQL 语句封装在一个过程中，从而避免 SQL 注入攻击。
5. **定期安全审计**：定期对数据库进行安全审计，及时发现和修复安全漏洞。


## 点击劫持

`点击劫持（Clickjacking）`是一种`视觉欺骗攻击`，攻击者通过在网页中`嵌入一个透明的 iframe`，将用户的点击操作引导到其他页面或执行其他恶意操作。

### **一、点击劫持的原理**

点击劫持的原理是`利用 HTML 的 iframe 元素`，将一个恶意页面嵌入到受害者的页面中。

由于` iframe 元素可以设置为透明`，因此受害者无法看到恶意页面的存在。`当受害者点击页面上的某个位置时，实际上是点击了恶意页面中的相应位置`，从而执行了攻击者预设的操作。

### **二、点击劫持的危害**

点击劫持的危害主要包括以下几个方面：

1. **窃取用户信息**：攻击者可以通过点击劫持窃取用户的登录凭证、信用卡信息等敏感信息。
2. **执行恶意操作**：攻击者可以通过点击劫持执行一些对用户有害的操作，例如修改用户密码、转账等。
3. **破坏用户体验**：点击劫持会破坏用户的正常体验，使用户感到困惑和不安。

### **三、点击劫持的防御**

点击劫持的防御主要包括以下几个方面：

1. **X-Frame-Options 头**：X-Frame-Options 头是一种 HTTP 头，用于`控制浏览器是否允许在 iframe 中加载页面`。通过设置 X-Frame-Options 头为 `DENY` 或 `SAMEORIGIN`，可以防止点击劫持攻击。
2. **Frame Busting 脚本**：Frame Busting 脚本是一种 JavaScript 脚本，用于`检测页面是否被嵌入到 iframe 中`。如果检测到页面被嵌入到 iframe 中，`Frame Busting 脚本会将页面重定向到原始页面`，从而防止点击劫持攻击。
3. **使用验证码**：使用验证码可以防止攻击者通过自动化工具进行点击劫持攻击。
4. **教育用户**：教育用户`不要轻易点击来自不可信来源的链接`，可以有效地防止点击劫持攻击。

总之，点击劫持是一种严重的安全威胁，需要采取有效的措施来进行防御。

## XSS、CSRF、点击劫持和 SQL 注入的关系

XSS、CSRF、点击劫持和 SQL 注入是四种常见的 Web 安全漏洞，它们之间存在一定的关联，但也有一些区别。

### **一、XSS（跨站脚本攻击）**

XSS 攻击是指攻击者`在网页中嵌入恶意脚本，当用户访问该网页时，恶意脚本会在用户的浏览器中执行`，从而窃取用户的敏感信息、篡改页面内容或执行其他恶意操作。

### **二、CSRF（跨站请求伪造）**

CSRF 攻击是指攻击者`利用用户已经登录的身份，在用户不知情的情况下，以用户的名义发送恶意请求`，从而执行一些对用户有害的操作，例如修改用户密码、转账等。

### **三、点击劫持**

点击劫持是一种视觉欺骗攻击，攻击者通过`在网页中嵌入一个透明的 iframe，将用户的点击操作引导到其他页面或执行其他恶意操作`。

### **四、SQL 注入**

SQL 注入是指攻击者通过`在输入参数中插入恶意的 SQL 代码，从而改变 SQL 语句的执行逻辑`，达到窃取数据、篡改数据或执行其他恶意操作的目的。

### **五、四者之间的关系**

1. XSS 和 CSRF 都可以`窃取用户的敏感信息`，但 XSS 是通过在网页中`嵌入恶意脚本`来实现的，而 CSRF 是通过`利用用户已经登录`的身份来实现的。
2. 点击劫持和 XSS、CSRF 都可以导致用户执行恶意操作，但`点击劫持是通过视觉欺骗`来实现的，而 `XSS 和 CSRF 是通过在网页中嵌入恶意代码或利用用户已经登录的身份`来实现的。
3. SQL 注入和`其他三种漏洞的攻击方式不同`，它是`通过在输入参数中插入恶意的 SQL 代码来实现的，主要目的是窃取数据或篡改数据`。

综上所述，XSS、CSRF、点击劫持和 SQL 注入是四种不同类型的 Web 安全漏洞，它们之间存在一定的关联，但也有一些区别。在开发 Web 应用程序时，需要采取相应的安全措施来防范这些漏洞。
