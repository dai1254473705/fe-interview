---
title: 6. yarn、npm、pnpm 三者对比
order: 6
---
# 6. yarn、npm、pnpm 三者对比

### 基本概念
- **`npm`**：是随同Node.js一起安装的包管理工具，是JavaScript生态系统中最早和最广泛使用的包管理工具，用于管理项目中的依赖包，包括安装、更新、卸载依赖等操作，拥有庞大的生态系统.
- **`yarn`**：是Facebook等公司推出的一款快速、可靠、安全的JavaScript包管理工具，旨在解决`npm`在安装速度、版本锁定等方面的一些问题，采用并行下载和缓存机制等优化手段来提高性能.
- **`pnpm`**：是一种新型的JavaScript包管理工具，它通过使用硬链接和符号链接等方式来优化依赖管理，在磁盘空间利用和安装速度方面有显著优势，尤其适用于大型项目和多项目共享依赖的场景.

### 性能方面
- **安装速度**：
    - **`yarn`**：安装速度相对较快，通过并行下载依赖包和缓存机制提升效率，能避免重复下载.
    - **`npm`**：在早期版本中顺序下载依赖包，虽后续有优化，但复杂项目场景下安装效率仍有待提高.
    - **`pnpm`**：安装速度出色，在处理多个项目依赖或大型项目时，其独特存储方式可减少重复下载相同版本依赖包的情况.
- **磁盘空间占用**：
    - **`yarn`**：和`npm`类似，每个项目的`node_modules`目录下存储项目所需所有依赖包副本，可能导致磁盘空间浪费.
    - **`npm`**：以嵌套方式存储依赖，可能使`node_modules`目录结构复杂，占用较多磁盘空间。
    - **`pnpm`**：采用节省磁盘空间的依赖存储方式，相同版本依赖包在磁盘上只存储一份，通过硬链接在不同项目中共享，大大减少磁盘空间占用.

#### npm 嵌套及平铺依赖

**npm v3之前的嵌套依赖存储方式**

- 在npm v3之前，依赖是严格按照嵌套方式存储的。例如，如果项目A依赖于模块B，模块B又依赖于模块C，那么在`node_modules`目录下会有`A`的文件夹，`A`的文件夹下有`node_modules`，里面存放`B`，而`B`的`node_modules`下存放`C`。
- 这种嵌套方式会导致目录结构非常深，尤其是当依赖关系复杂时，`node_modules`目录会变得臃肿且难以管理。而且，由于每个依赖都有自己独立的`node_modules`子目录，相同版本的依赖可能会被多次存储，从而占用较多磁盘空间。

**npm v3及之后的扁平依赖存储方式**

- npm v3引入了扁平的依赖存储方式。当安装依赖时，npm会尽量将依赖提升到`node_modules`的根目录下，以减少嵌套深度。例如，在上述例子中，模块`C`可能会和`A`、`B`一起被放置在`node_modules`的根目录下，而不是嵌套在`B`的`node_modules`中。
- 这样做的好处是可以减少`node_modules`目录的嵌套层数，使得目录结构相对扁平，一定程度上减少了磁盘空间的占用。
- 然而，这种扁平方式并不是完全摒弃了嵌套。例如，当存在依赖版本冲突时，npm可能会为不同版本的同一依赖创建嵌套的目录结构。假设项目中同时依赖模块`D`的`1.0.0`版本和`2.0.0`版本，那么可能会在`node_modules`下创建`D@1.0.0`和`D@2.0.0`这样的嵌套目录来分别存放不同版本的`D`。
- 所以，虽然npm v3及之后在依赖存储方式上有了很大的改进，但在处理一些复杂的依赖场景时，`node_modules`目录结构仍然可能会变得复杂，只是相比v3之前的情况已经有了明显的优化。

### 依赖管理方面
- **依赖锁定文件**：
    - **`yarn`**：使用`yarn.lock`文件锁定依赖版本，详细记录依赖包及其子依赖的版本号、下载地址等信息，确保不同环境下安装的依赖版本一致.
    - **`npm`**：主要依赖`package-lock.json`文件锁定版本，功能与`yarn.lock`类似，但在一些细节上因版本解析规则等因素可能存在差异.
    - **`pnpm`**：通过内部机制确保依赖一致性，虽无类似`yarn.lock`或`package-lock.json`的单独锁定文件，但也能有效管理依赖版本.
- **工作区（Workspaces）支持**：
    - **`yarn`**：对工作区支持良好，在项目根目录`package.json`中配置工作区后，可自动构建项目间链接关系，提供方便的工作区相关命令.
    - **`npm`**：支持工作区功能，在`package.json`中配置工作区范围后，可管理Monorepo项目中的本地依赖关系，但在复杂场景下处理依赖方式相对复杂.
    - **`pnpm`**：很好地支持工作区，可在项目根目录配置工作区信息后，有效管理工作区内依赖关系，避免重复安装和占用过多磁盘空间，适用于Monorepo架构项目.

### 使用便捷性方面
- **命令语法**：
    - **`yarn`**：命令语法简洁明了，格式统一，如安装本地依赖包`yarn add <package-name>`，卸载`yarn remove <package-name>`，更新`yarn upgrade <package-name>`.
    - **`npm`**：命令格式多样，如安装本地依赖`npm install <package-name>`，卸载`npm uninstall <package-name>`，更新`npm update <package-name>`.
    - **`pnpm`**：命令与`npm`、`yarn`有相似性，如安装本地依赖`pnpm add <package-name>`，卸载`pnpm remove <package-name>`，更新`pnpm update <package-name>`.
- **生态系统兼容性**：
    - **`yarn`**：作为后起之秀，部分专为`npm`设计的工具或插件可能不兼容，但随着普及情况逐渐改善。
    - **`npm`**：拥有最庞大的生态系统，几乎所有JavaScript库和工具都原生支持。
    - **`pnpm`**：生态兼容性不断提升，大部分常见JavaScript库和工具都可正常使用其管理，随着性能优势被认知，应用逐渐增多。

### 特定场景相关问题
- **`yarn`**：在一些对离线安装有需求的场景中，`yarn`的离线缓存功能可能会被问到，它可以提前缓存依赖包，以便在无网络环境下进行安装.
- **`npm`**：由于其广泛使用，可能会问到一些与全局安装和局部安装相关的问题，如全局安装的依赖包如何管理、全局安装和局部安装的区别及使用场景等.
- **`pnpm`**：在处理大型项目或多个项目共享依赖的场景下，`pnpm`的优势较为突出，可能会被问到如何利用`pnpm`更好地管理多项目的依赖版本、如何解决共享依赖中的冲突等问题.
 